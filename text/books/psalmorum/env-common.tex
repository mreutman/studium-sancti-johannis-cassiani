\usepackage[none]{hyphenat}
\usepackage{changepage}
\usepackage{fancyhdr}
\usepackage{fontspec}
\usepackage{ifthen}
\usepackage{multirow}
\usepackage{needspace}
\usepackage{ragged2e}
\usepackage{setspace}
\usepackage{titlesec}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FONTS

\setmainfont[
  Path = ./fonts/dueblo/,
  Extension = .otf,
  UprightFont = *-MED,
  BoldFont = *-BOL,
  ItalicFont = *-REG,
  BoldItalicFont = *-BOL,
  Ligatures = {NoCommon, NoDiscretionary},
]{Dueblo-SEMI-EXT}

\newfontfamily{\liturgy}[
  Path = ./fonts/liturgy/,
  Extension = .ttf,
  UprightFont = *-Regular,
]{Liturgy}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SYMBOLS

\newcommand{\symbolCross}{{\liturgy +}}
\newcommand{\symbolDagger}{‚Ä†}
\newcommand{\symbolResponse}{{\liturgy R}}
\newcommand{\symbolVersicle}{{\liturgy V}}
\newcommand{\symbolPoint}{ùÑ™}
\newcommand{\symbolBreak}{\raisebox{-0.10em}{\itshape /}}
\newcommand{\symbolFinal}{\raisebox{-0.10em}{\itshape //}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FORMAT

\newenvironment{nscenter}
 {\parskip=0pt\par\nopagebreak\centering}
 {\par\noindent\ignorespacesafterend}

\newenvironment{nsflushleft}
 {\parskip=0pt\par\nopagebreak\RaggedRight}
 {\par\noindent\ignorespacesafterend}

\newenvironment{nsflushtest}
 {\parskip=0pt\par}
 {\par\noindent\ignorespacesafterend}

\def\tinyskip{\vspace\tinyskipamount}
\newskip\tinyskipamount \tinyskipamount=1pt plus 1pt minus 0pt

\newcommand{\RomanNumeralCaps}[1]{\MakeUppercase{\romannumeral #1}}

\renewcommand{\thepage}{\pageNumberFormat\arabic{page}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FUNCTIONS

\newcommand{\firstLetter}[1]
  {{\sizeVerseFirstLetter #1}}


\newcommand{\decoratorCross}[1]{%

  \vspace{#1}
  {\noindent\hfill{\LARGE \symbolDagger}\hfill}
  \vspace{#1}

}

\newcommand{\decoratorI}[1]{%

  \vspace{#1}
  {\noindent\hfill{\decoratorFormat \symbolCross}\hfill}
  \vspace{#1}

}

\newcommand{\decoratorII}[1]{%

  \vspace{#1}
  {\noindent\hfill{\decoratorFormat \symbolCross \decoratorHSpace \symbolCross}\hfill}
  \vspace{#1}

}

\newcommand{\decoratorIII}[1]{%

  \vspace{#1}
  {\noindent\hfill{\decoratorFormat\symbolCross \decoratorHSpace \symbolCross \decoratorHSpace \symbolCross}\hfill}
  \vspace{#1}

}

\newcommand{\decoratorINewPage}{%

  \vfill\vfill
  {\noindent\hfill{\decoratorFormat \decoratorIRule \decoratorRuleHSpace \symbolCross \decoratorRuleHSpace \decoratorIRule}\hfill}
  \vfill
  \newpage
}

\newcommand{\decoratorIINewPage}{%

  \vfill\vfill
  {\noindent\hfill{\decoratorFormat \decoratorIIRule \decoratorRuleHSpace \symbolCross \decoratorHSpace \symbolCross \decoratorRuleHSpace \decoratorIIRule}\hfill}
  \vfill
  \newpage
}

\newcommand{\decoratorIIINewPage}{%

  \vfill\vfill
  {\noindent\hfill{\decoratorFormat\decoratorIIIRule \decoratorRuleHSpace \symbolCross \decoratorHSpace \symbolCross \decoratorHSpace \symbolCross \decoratorRuleHSpace \decoratorIIIRule}\hfill}
  \vfill
  \newpage
}

\newcommand{\decoratorBegin}{%
  {\noindent\hfill{\decoratorFormat \symbolCross}\hfill}
  \vspace{0.25em}
}

\newcommand{\decoratorEnd}{%

  \vfill
  {\noindent\hfill{\Large \decoratorEndRule \decoratorRuleHSpace \symbolCross \decoratorRuleHSpace \decoratorEndRule}\hfill}
  \vfill
  {\noindent\hfill\psalmEndFormat\textsc{Finis psalmorum} \hfill}
  \vfill
}

\newcommand{\decoratorPoint}[1]{%

  \vspace{#1}
  {\noindent\hfill{\decoratorPointFormat \symbolPoint}\hfill}
  \vspace{#1}

}

\newcommand{\decoratorPointNewPage}{%

  \vfill\vfill
  {\noindent\hfill{\decoratorPointFormat \symbolPoint}\hfill}
  \vfill
  \newpage
}

\newcommand{\verseNum}[1]
  {\textup{\textsuperscript{\itshape\sizeVerseNumber #1.}}}

\newcommand{\verseNumInscription}[1]
  {\textsuperscript{\textup{\itshape\sizeVerseNumberInscription #1.}}}

\newcommand{\psalmChapterNumberTitle}[1]{%
  {%
    \psalmTitleFormat \textsc{Psalmus} {%
      \psalmTitleNumberFormat\RomanNumeralCaps{#1}.
    }
  }
}

\newcommand{\psalmBody}[1]{%
  \noindent\textsc{\psalmBodyFormat #1}
}

\newcommand{\psalmChapterNumberBegin}{%
  \begingroup
  \justifying
  \leftskip=\psalmChapterNumberIndent
  \advance\csname @rightskip\endcsname \leftskip \advance\rightskip \leftskip
  \psalmChapterNumberFormat
  \setstretch{\psalmChapterNumberSpacing}
}

\newcommand{\psalmChapterNumberEnd}{%
  \par
  \endgroup
}

\newcommand{\psalmChapterNumber}[1]{
  {%
    \psalmChapterNumberBegin
    \noindent\psalmChapterNumberTitle{#1}
    \psalmChapterNumberEnd
  }
}

\newcommand{\psalmChapterNumberInscription}[2]{
  {%
    \psalmChapterNumberBegin
    \noindent\psalmChapterNumberTitle{#1}\textsc{\psalmInscriptionFormat #2}
    \psalmChapterNumberEnd
  }
}

\newcommand{\psalmDivision}[2]{%
  \markboth%
    {\pageHeaderFormat DIVIZIO \RomanNumeralCaps{#1}.\RomanNumeralCaps{#2}.}%
    {\pageHeaderFormat DIVIZIO \RomanNumeralCaps{#1}.\RomanNumeralCaps{#2}.}%
  {\psalmDivisionFormat \textsc{Divizio} \RomanNumeralCaps{#1}.\RomanNumeralCaps{#2}.}
}

% PUBLIC - - - - - - - - - - - - -
\newcommand{\psalmBeginDivision}[3]{%
  \psalmChapterDivisionNeedSpace
  {\noindent\hfill\psalmDivisionLeft \psalmDivision{#2}{#3} \psalmDivisionRight\hfill}

  \vspaceChapterTitle

  \psalmBody{#1}
}

\newcommand{\psalmChapterBeginDivision}[4]{%
  \psalmChapterDivisionNeedSpace
  {%
    {\noindent\hfill\psalmDivisionLeft \psalmDivision{#3}{#4} \psalmDivisionRight\hfill}

    \vspaceDivision
    {\psalmChapterNumber{#1}}
  }
  \vspaceChapterTitle
  \psalmBody{#2}
}

\newcommand{\psalmChapterInscriptionBeginDivision}[5]{%
  \psalmChapterDivisionNeedSpace
  {%
    {\noindent\hfill\psalmDivisionLeft \psalmDivision{#4}{#5} \psalmDivisionRight\hfill}

    \vspaceDivision
    {\psalmChapterNumberInscription{#1}{#2}}
  }
  \vspaceChapterTitle
  \psalmBody{#3}
}

\newcommand{\psalmChapter}[2]{%
  \psalmChapterNeedSpace
  {\psalmChapterNumber{#1}}
  \vspaceChapterTitle
  \psalmBody{#2}
}

\newcommand{\psalmChapterInscription}[3]{%
  \psalmChapterNeedSpace
  \psalmChapterNumberInscription{#1}{#2}

  \vspaceChapterTitle

  \psalmBody{#3}
}

\newcommand{\prayerPageTitle}{%
  \decoratorCross{0.25em}

  {\noindent\bfseries\large\hfill \prayerDivisionLeft \textsc{Ora√ßiones} \prayerDivisionRight \hfill}
}

\newcommand{\prayerText}[2]{%
  \psalmChapterNeedSpace
  {
    \psalmChapterNumberBegin
    \psalmTitleFormat \textsc{#1}
    \psalmChapterNumberEnd
  }

  \vspaceChapterTitle
  \psalmBody{#2}
}

\newcommand{\prayerTextContinue}[1]{%

  \vspacePrayerContinue
  \psalmBody{#1}
}
